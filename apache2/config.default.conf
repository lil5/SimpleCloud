<VirtualHost *:443>
	ServerName localhost
	DocumentRoot /var/www/dash/

	SSLEngine On
	SSLProxyEngine On
	SSLProxyCheckPeerCN Off
	SSLCertificateFile	/opt/simplecloud/_config_cache/openssl/site.crt
	SSLCertificateKeyFile /opt/simplecloud/_config_cache/openssl/site.key
	SSLCertificateChainFile /opt/simplecloud/_config_cache/openssl/root-ca.crt

	ProxyRequests Off
	ProxyPreserveHost On

	RewriteEngine On
	RewriteRule ^/radicale$ /radicale/ [R,L]
	RewriteRule ^/irc$ /irc/ [R,L]
	RewriteRule ^/peer$ /peer/ [R,L]
	RewriteRule ^/photato$ /photato/ [R,L]

	Alias /webdav /data/simplecloud/storage
	Alias /webdav-js /var/www/webdav-js

	Alias /gallery /data/simplecloud/smallergallery/gallery

	<Location "/radicale/">
		ProxyPass        http://localhost:5232/ retry=0
		ProxyPassReverse http://localhost:5232/
		RequestHeader    set X-Script-Name /radicale/
	</Location>

	<Location "/peer/">
		ProxyPass        http://localhost:3000/peer/ retry=0
		ProxyPassReverse http://localhost:3000/peer/
	</Location>

	<Location "/irc/">
		ProxyPass        http://localhost:9000/ retry=0
		ProxyPassReverse http://localhost:9000/
	</Location>

	<Location /gallery>
		ReadmeName /gallery/.header.html
		SetHandler None
		DirectoryIndex disabled
		AllowOverride None
		Options +Indexes
		Require valid-user
	</Location>

	<Location /webdav>
		HeaderName /webdav-js/examples/apache-directory-list-local/header.html
		SetHandler None
		DirectoryIndex disabled
		Options +Indexes +FollowSymlinks -MultiViews -ExecCGI
		DAV On
		AllowOverride None
		DavMinTimeout 600
		AuthType Basic
		AuthName "Unauthorized"
		AuthUserFile /opt/simplecloud/_config_cache/users.passwd
		<Limit GET OPTIONS PROPFIND>
			Require valid-user
		</Limit>
	</Location>

	<Directory /var/www/webdav-js>
		Satisfy all
		<LimitExcept GET>
			Deny from all
		</LimitExcept>
	</Directory>

	<Location /webdav/share>
		DAV On
		Require valid-user
	</Location>

	<Location /webdav/user>
		DAV On
		Require user user
	</Location>

</VirtualHost>
